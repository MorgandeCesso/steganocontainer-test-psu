# DOCX Stego Prototype

Так, ну, в целом вот, вроде как стегаконтейнер +- по логике статьи получился.

## Как это работает

### Как шифруется и встраивается

1. **Шифрование данных**
   - Исходный текст/файл преобразуется в байты
   - Генерируется случайная соль (16 байт) и nonce (12 байт)
   - Пароль преобразуется в ключ шифрования через алгоритм scrypt (n=2^15, r=8, p=1)
   - Данные шифруются алгоритмом AES-GCM с использованием полученного ключа
   - Формируется пакет: маркер `STEGDOC1` (8 байт) + соль + nonce + длина шифротекста + шифротекст

2. **Встраивание в изображение**
   - PNG изображение конвертируется в RGB формат
   - В младшие биты каждого RGB канала встраиваются биты зашифрованных данных
   - Каждый пиксель содержит 3 бита данных (по одному на канал R, G, B)
   - Перед данными записывается 4-байтовый префикс с длиной полезной нагрузки
   - Создается стегоизображение (визуально идентичное оригиналу)

3. **Создание DOCX документа**
   - Создается новый DOCX документ с заголовком и описанием
   - Стегоизображение вставляется в документ как обычное изображение
   - DOCX сохраняется (изображение хранится в `word/media/*.png`)

### Как это дело извлекается

1. **Пуллим пикчу из DOCX**
   - DOCX файл открывается как ZIP архив
   - Находится первое PNG изображение в папке `word/media/`
   - Изображение извлекается во временный файл

2. **Пуллим данные из изображения**
   - Изображение конвертируется в RGB
   - Из младших битов каждого RGB канала извлекаются биты данных
   - Читается 4-байтовый префикс с длиной полезной нагрузки
   - Извлекается зашифрованный пакет данных

3. **Расшифровка**
   - Проверяется маркер `STEGDOC1`
   - Извлекаются соль и nonce из заголовка пакета
   - Пароль преобразуется в ключ через scrypt с использованием сохраненной соли
   - Данные расшифровываются алгоритмом AES-GCM
   - Возвращается исходный текст/файл

## Мб понадобится

- **Алгоритм шифрования** - AES-GCM (256-битный ключ)
- **Производная ключа** - scrypt (n=32768, r=8, p=1)
- **Метод стеганографии** - LSB (Least Significant Bit) в RGB каналах
- **Формат изображения** - PNG (обязательно lossless, JPG не поддерживается)
- **Емкость** - ~3 бита на пиксель (ширина × высота × 3 / 8 байт)

## Запуск

### Генерация документа с стегоконтейнером внутри изображения
```bash
python main.py embed --cover-png cover.png --message "Секретный блок отчёта A3. Доступ: роль Инженер." --password "StrongPass123" --out-docx report.docx
```

### Извлечение стегоконтейнера из документа
```bash
python main.py extract --in-docx report.docx --password "StrongPass123"
```

## Утилиты для анализа и визуализации

Проект включает несколько утилит для анализа LSB-плоскостей и визуализации изменений в стегоизображениях.

### lsb_view.py — просмотр LSB-плоскостей изображения

Визуализирует младшие биты (LSB) одного или всех RGB-каналов изображения.

```bash
python lsb_view.py --image cover.png --mode combined --save cover_LSB_COMBINED.png --show
```

**Параметры:**
- `--image` — путь к изображению (обязательно)
- `--mode` — режим отображения: `r`, `g`, `b` или `combined` (по умолчанию `combined`)
- `--save` — путь для сохранения результата (по умолчанию `lsb_view.png`)
- `--show` — показать окно с визуализацией

### lsb_compare.py — сравнение LSB-плоскостей cover и stego

Сравнивает LSB-плоскости двух изображений, создает дельта-карты и выводит статистику изменений.

```bash
python lsb_compare.py --cover cover.png --stego stego.png --outdir out --show
```

**Параметры:**
- `--cover` — оригинальное изображение (обязательно)
- `--stego` — стегоизображение (обязательно)
- `--outdir` — директория для сохранения результатов (по умолчанию `lsb_compare_out`)
- `--show` — показать окно с визуализацией
- `--amp` — коэффициент увеличения для визуализации (по умолчанию 1)

**Результаты:**
- LSB-плоскости для cover и stego (R, G, B, комбинированная)
- Дельта-карты изменений (белый = измененный бит)
- Статистика: процент измененных пикселей по каждому каналу

### delta_view.py — визуализация дельты для одного канала

Показывает изменения LSB для выбранного RGB-канала между двумя изображениями.

```bash
python delta_view.py --cover cover.png --stego stego.png --ch r --save delta_lsb_view.png --show
```

**Параметры:**
- `--cover` — оригинальное изображение (обязательно)
- `--stego` — стегоизображение (обязательно)
- `--ch` — канал: `r`, `g` или `b` (по умолчанию `r`)
- `--save` — путь для сохранения (по умолчанию `delta_lsb_view.png`)
- `--show` — показать окно с визуализацией

### overlay_changed_pixels.py — наложение маски измененных пикселей

Накладывает цветную маску на изображение, выделяя пиксели с измененными LSB.

```bash
python overlay_changed_pixels.py --cover cover.png --stego stego.png --base cover --mode any --color 255,0,0 --alpha 0.7 --save overlay.png --show
```

**Параметры:**
- `--cover` — оригинальное изображение (обязательно)
- `--stego` — стегоизображение (обязательно)
- `--base` — базовое изображение для наложения: `cover` или `stego` (по умолчанию `cover`)
- `--mode` — режим выделения: `any`, `r`, `g`, `b` или `all` (по умолчанию `any`)
- `--color` — цвет маски в формате R,G,B (по умолчанию `255,0,0` — красный)
- `--alpha` — прозрачность маски от 0 до 1 (по умолчанию `0.7`)
- `--save` — путь для сохранения (по умолчанию `overlay.png`)
- `--show` — показать окно с визуализацией

### overlay_heatmap.py — тепловая карта плотности изменений

Создает тепловую карту, показывающую плотность измененных пикселей по блокам.

```bash
python overlay_heatmap.py --cover cover.png --stego stego.png --base cover --block 16 --save overlay_heatmap.png --show
```

**Параметры:**
- `--cover` — оригинальное изображение (обязательно)
- `--stego` — стегоизображение (обязательно)
- `--base` — базовое изображение: `cover` или `stego` (по умолчанию `cover`)
- `--block` — размер блока для расчета плотности в пикселях (по умолчанию 16)
- `--save` — путь для сохранения (по умолчанию `overlay_heatmap.png`)
- `--show` — показать окно с визуализацией